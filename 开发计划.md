# 地脉归途 (Leyhome) - 10天开发计划

## 总体说明

**总工期**: 12天
- 开发: 10天
- 上架审核: 2天

**开发范围**: 聚焦MVP核心功能（P0级别），部分P1功能简化实现

**技术栈**: Swift 5.9 + SwiftUI + MapKit + CoreLocation + Supabase

---

## 详细开发计划

### 第1天：项目基础架构 & 用户系统UI

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| 项目结构搭建 | 创建标准SwiftUI项目结构，Models/Views/Services/Managers目录 | 1h |
| Tab导航架构 | 4个核心Tab：心灵地图、圣迹、引路、我的 | 1.5h |
| 设计系统基础 | 主题色定义、字体、间距、通用组件 | 2h |
| 用户系统UI | 登录/注册页面、Apple ID登录按钮 | 2h |
| Supabase配置 | 创建项目、配置数据库表结构、环境变量 | 1.5h |

**交付物**: 可运行的空壳App，包含导航结构和登录界面

---

### 第2天：用户系统 & 数据层

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| Apple ID登录 | Sign in with Apple集成，获取用户信息 | 2h |
| Supabase Auth | 与Supabase Auth对接，JWT管理 | 2h |
| 用户数据模型 | User模型、Profile管理 | 1.5h |
| SwiftData配置 | 本地数据持久化，离线支持 | 1.5h |
| 个人中心页面 | 基础设置页面、退出登录 | 1h |

**交付物**: 完整的用户认证流程

---

### 第3天：心灵地图核心 - GPS轨迹记录

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| CoreLocation配置 | 后台定位权限、精确定位请求 | 1h |
| LocationManager | 封装定位服务，开始/结束记录 | 2h |
| 智能采样算法 | 根据速度调整采样频率，降低功耗 | 1.5h |
| 出行方式识别 | 基于速度区间自动判断出行方式 | 1h |
| Track数据模型 | 轨迹数据结构，PostGIS geometry | 1.5h |
| 记录控制UI | 开始/结束记录按钮，实时状态显示 | 1h |

**交付物**: 可以后台记录GPS轨迹并识别出行方式

---

### 第4天：心灵地图核心 - 能量线渲染

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| MapKit集成 | 基础地图显示，定位当前位置 | 1h |
| 能量线渲染器 | 自定义MKPolyline渲染，不同颜色 | 2.5h |
| 出行方式样式 | 步行(琥珀色)/骑行(青色)/驾车(银白)/飞行(紫色) | 2h |
| 脉动动画 | 能量线的呼吸感动画效果 | 1.5h |
| 地图交互 | 平移、缩放、定位当前位置 | 1h |

**交付物**: 能够显示艺术化能量线的心灵地图

---

### 第5天：心绪节点系统

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| Node数据模型 | 心绪节点结构，关联轨迹位置 | 1h |
| 情绪标签选择器 | 预设情绪图标/色彩选择组件 | 1.5h |
| 节点创建流程 | 点击轨迹→选择情绪→添加内容 | 2h |
| 文字记录 | 简洁文本输入框 | 0.5h |
| 照片记录 | 相机/相册选择，图片预览 | 1.5h |
| 节点地图标记 | 在地图上显示心绪节点，点击查看详情 | 1.5h |

**交付物**: 完整的心绪节点创建和查看功能

---

### 第6天：圣迹系统

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| SacredSite数据模型 | 三层圣迹体系结构 | 1h |
| 预置圣迹数据 | 导入10-20个示例圣迹 | 1h |
| 星脉图视图 | 艺术化的世界地图展示，星辰标记 | 2h |
| 圣迹列表页 | 按大洲分类，搜索功能 | 1.5h |
| 圣迹详情页 | 头图、名称、地脉解读、历史传说 | 2h |
| 图标设计 | 三层圣迹的不同图标样式 | 0.5h |

**交付物**: 完整的圣迹浏览体验

---

### 第7天：回响系统 & 意向系统

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| Echo数据模型 | 回响内容结构 | 0.5h |
| 回响发布UI | 文字输入、媒体选择、隐私设置 | 2h |
| 回响列表展示 | 瀑布流/时间线展示 | 1.5h |
| 零回响状态 | 空状态引导文案 | 0.5h |
| Intention数据模型 | 意向记录结构 | 0.5h |
| "我亦向往"功能 | 月份选择、确认标记 | 1.5h |
| 意向统计展示 | "已有X位行者向往…" | 1.5h |

**交付物**: 完整的回响和意向功能

---

### 第8天：引路系统 & 数据同步

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| Guide数据模型 | 先行者信息结构 | 0.5h |
| 预置先行者数据 | 导入2-3个示例先行者 | 1h |
| 先行者列表页 | 卡片展示，肖像、名字、简介 | 1.5h |
| 星图数据模型 | Constellation结构 | 0.5h |
| 星图展示 | 先行者的行走系列预览 | 1.5h |
| Supabase同步 | 轨迹/节点/回响的云端同步 | 2h |
| 离线缓存策略 | 本地优先，网络可用时同步 | 1h |

**交付物**: 先行者浏览功能 + 数据云同步

---

### 第9天：UI美化 & 动效 & 优化

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| 视觉优化 | 全局色彩/字体/间距调整 | 2h |
| 图标资源 | App图标、Tab图标、功能图标 | 1.5h |
| 动画效果 | 页面转场、按钮反馈、节点添加动画 | 2h |
| 触觉反馈 | Haptic feedback on interactions | 0.5h |
| 启动页 | LaunchScreen设计 | 0.5h |
| 引导页 | 首次使用的Onboarding流程 | 1.5h |

**交付物**: 完善的视觉体验

---

### 第10天：测试 & 修复 & 上架准备

| 任务 | 详细内容 | 预计工时 |
|------|----------|----------|
| 功能测试 | 全流程功能测试，边界情况 | 2h |
| Bug修复 | 解决发现的问题 | 2h |
| 性能优化 | 地图渲染、内存占用检查 | 1h |
| App Store资源 | 截图(6张)、预览视频 | 1.5h |
| 文案准备 | App描述、关键词、隐私政策 | 1h |
| Archive打包 | 最终版本构建 | 0.5h |

**交付物**: 可提交审核的App包

---

### 第11-12天：App Store审核

| 任务 | 详细内容 |
|------|----------|
| 提交审核 | 上传App Store Connect |
| 处理反馈 | 回复审核团队问题 |
| 紧急修复 | 如有拒绝，快速修复重新提交 |
| 准备上线 | 设置价格、地区、发布时间 |

---

## MVP功能清单 (10天内完成)

### P0 必须实现
- [x] 用户系统：Apple ID登录、个人中心
- [x] 心灵地图：GPS轨迹记录、能量线渲染、心绪节点
- [x] 圣迹系统：星脉图、圣迹列表、圣迹详情

### P1 简化实现
- [x] 回响系统：基础UGC发布（文字+图片）
- [x] 意向系统：基础意向标记
- [x] 引路系统：先行者展示、星图预览

### P2 延后实现
- [ ] 共鸣行走：完整的跟走体验 → V1.1
- [ ] 强制反思：对话机制 → V1.1
- [ ] 寻迹申请：用户提名圣迹 → V1.2
- [ ] 旅程规划器：多模式出行 → V1.2
- [ ] 商业化系统：订阅内购 → V1.3
- [ ] 语音胶囊/视频：媒体扩展 → V1.3

---

## 技术要点提醒

### 后台定位
```swift
// Info.plist 必须配置
UIBackgroundModes: location
NSLocationAlwaysAndWhenInUseUsageDescription
NSLocationWhenInUseUsageDescription
```

### Supabase核心表
```sql
-- 最小可用表结构
users, tracks, nodes, sacred_sites, echoes, intentions, guides
```

### 必要的权限
- 定位权限（精确定位 + 后台定位）
- 相机权限
- 相册权限

---

## 风险与应对

| 风险 | 概率 | 应对措施 |
|------|------|----------|
| GPS后台定位被杀 | 中 | 使用allowsBackgroundLocationUpdates + 智能恢复 |
| 能量线渲染卡顿 | 低 | 数据分页加载，限制单次显示轨迹数 |
| 审核被拒 | 中 | 确保隐私政策完整，定位权限说明清晰 |
| 时间不足 | 中 | 优先核心功能，非必要功能延后 |

---

## 每日检查点

| 天数 | 核心交付 | 验收标准 |
|------|----------|----------|
| D1 | 项目骨架 | Tab导航可切换，登录页显示 |
| D2 | 用户系统 | Apple ID可登录，用户信息保存 |
| D3 | GPS记录 | 后台可记录轨迹，自动识别出行方式 |
| D4 | 能量线 | 地图显示艺术化轨迹线 |
| D5 | 心绪节点 | 可添加/查看节点 |
| D6 | 圣迹浏览 | 可浏览圣迹列表和详情 |
| D7 | 回响+意向 | 可发布回响，可标记意向 |
| D8 | 引路+同步 | 先行者可浏览，数据可同步 |
| D9 | UI完善 | 视觉体验流畅 |
| D10 | 提交准备 | App包可正常安装运行 |

---

**文档版本**: v1.0
**创建日期**: 2026-01-25
**作者**: Claude Code

*"所有的出发，都是为了回家。"*
